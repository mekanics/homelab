kube-prometheus-stack:
  # https://github.com/prometheus-community/helm-charts/blob/kube-prometheus-stack-45.30.1/charts/kube-prometheus-stack/values.yaml
  grafana:
    enabled: true
    defaultDashboardsTimezone: Europe/Zurich
    forceDeployDatasources: true
    forceDeployDashboards: true
    # http://docs.grafana.org/administration/provisioning/#datasources

    datasources:
      env:
        - name: INFLUX_TOKEN
          valueFrom:
            secretKeyRef:
              name: influxdb-auth
              key: admin-token

    additionalDataSources:
      - name: Loki
        type: loki
        url: http://loki.loki:3100
      - name: InfluxDB
        type: influxdb
        url: http://influx-influxdb2.influx.svc
        access: proxy
        jsonData:
          organization: waid
          defaultBucket: waid-bucket
          httpMode: POST
          version: Flux
          tlsSkipVerify: true
        secureJsonData:
          token: $INFLUX_TOKEN

      - name: Sun and Moon
        type: fetzerch-sunandmoon-datasource
        access: proxy
        basicAuth: false
        jsonData:
          latitude: 47.3990478335303
          longitude: 8.511763550691876

    plugins:
      - grafana-clock-panel
      - fetzerch-sunandmoon-datasource

    grafana.ini:
      server:
        root_url: https://grafana.mekanics.ch
    adminPassword: null
    ingress:
      enabled: true
      ingressClassName: nginx
      annotations:
        cert-manager.io/cluster-issuer: mekanics-ca-issuer
        hajimari.io/group: Monitoring
        hajimari.io/appName: Grafana
        hajimari.io/icon: chart-bar
      hosts:
        - &host grafana.mekanics.ch
      tls:
        - secretName: grafana-general-tls
          hosts:
            - *host
  prometheus:
    prometheusSpec:
      ruleSelectorNilUsesHelmValues: false
      serviceMonitorSelectorNilUsesHelmValues: false
      podMonitorSelectorNilUsesHelmValues: false
      probeSelectorNilUsesHelmValues: false
