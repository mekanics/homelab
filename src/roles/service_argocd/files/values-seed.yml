# https://github.com/argoproj/argo-helm/blob/main/charts/argo-cd/values.yaml

argo-cd:
  server:
    extraArgs:
      - --insecure

    config:
      statusbadge.enabled: 'true'

    metrics: &metrics
      enabled: true
      serviceMonitor:
        enabled: true

  dex:
    metrics: *metrics
  controller:
    metrics: *metrics
  repoServer:
    metrics: *metrics
  redis:
    # Explicitly enable Redis
    enabled: true
    name: redis

    # Use official Redis image
    image:
      repository: public.ecr.aws/docker/library/redis
      tag: 7.4.2-alpine

    # CRITICAL: Disable Redis authentication
    auth:
      enabled: false

    # Security context
    containerSecurityContext:
      runAsNonRoot: true
      readOnlyRootFilesystem: true
      allowPrivilegeEscalation: false
      runAsUser: 999
      seccompProfile:
        type: RuntimeDefault

    # Resources for Raspberry Pi
    resources:
      limits:
        cpu: 200m
        memory: 128Mi
      requests:
        cpu: 100m
        memory: 64Mi

    metrics: *metrics
